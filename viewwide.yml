- name: Filter Wide IP list based on search query
  hosts: localhost
  gather_facts: no
  vars:
    search_query: "{{ search_query }}"
  tasks:
    - name: Fetch Wide IP list
      uri:
        url: "https://139.150.254.31/mgmt/tm/gtm/wideip/a"
        method: GET
        user: "hdg7025"
        password: "^kdgksrk30%"
        validate_certs: no
      register: wideip_list

    - name: Filter and display Wide IPs
      debug:
        msg: >
          {%- set result = [] -%}
          {%- for item in wideip_list.json.items -%}
            {%- if search_query in item.name -%}
              {%- set pools = item.pools | default([]) -%}
              {%- set pools_cname = item.poolsCname | default([]) -%}
              {%- set pool_names = pools | map(attribute='name') | default([]) -%}
              {%- set cname_names = pools_cname | map(attribute='name') | default([]) -%}
              {%- set _ = result.append({ 'Wide IP Name': item.name, 'Pools': pool_names, 'Pools CNAME': cname_names }) -%}
            {%- endif -%}
          {%- endfor -%}
          {{ result }}
